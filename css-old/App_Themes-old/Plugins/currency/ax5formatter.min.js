"use strict";(function(){var i=ax5.ui,t=ax5.util,n;i.addClass({className:"formatter",version:"0.6.1"},function(){var r=new Date,i=function(n,t){if(typeof t=="undefined"&&(t=n.value.length),n.setSelectionRange)n.focus(),n.setSelectionRange(t,t);else if(n.createTextRange){var i=n.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",t);i.select()}else n.selectionStart&&(n.focus(),n.selectionStart=t,n.selectionEnd=t)};return function(){var e=this,u;this.instanceId=ax5.getGuid();this.config={animateTime:250};this.queue=[];this.openTimer=null;this.closeTimer=null;u=this.config;var r={focus:function(n){n.$input.data("__originValue__")||n.$input.data("__originValue__",n.$input.val())},keydown:function(n,t,i){var r=!1;n.enterableKeyCodes&&(i.which&&n.enterableKeyCodes[i.which]||i.metaKey||i.ctrlKey||i.shiftKey||(r=!0));r&&ax5.util.stopEvent(i)},keyup:function(t,r,u){var f=t.$input.get(0),s,e,o,h,c;"selectionStart"in f?s=f.selectionStart:document.selection&&(h=document.selection.createRange(),c=document.selection.createRange().text.length,h.moveStart("character",-f.value.length),s=h.text.length-c);e=f.value;o=t.pattern in n.formatter?n.formatter[t.pattern].getPatternValue.call(this,t,r,u,f.value):e;o!=e&&(t.$input.val(o).trigger("change"),i(f,s+o.length-e.length))},blur:function(t,i,r,u){var o=t.$input.get(0),e,f;t.$input.removeData("__originValue__");e=o.value;f=t.pattern in n.formatter?n.formatter[t.pattern].getPatternValue.call(this,t,i,r,o.value,"blur"):e;u?t.$input.val(f):f!=e&&t.$input.val(f).trigger("change")}},f=function(t,i){if(!t.pattern&&(t.pattern=t.$target.get(0).tagName=="INPUT"?t.$target.attr("data-ax5formatter"):t.$target.find('input[type="text"]').attr("data-ax5formatter"),!t.pattern))return console.log(ax5.info.getError("ax5formatter","501","bind")),console.log(t.target),this;var u=t.pattern.match(/[^\(^\))]+/gi);return t.pattern=u[0],t.patternArgument=u[1]||"",t.pattern in n.formatter&&(t.enterableKeyCodes=n.formatter[t.pattern].getEnterableKeyCodes.call(this,t,i)),t.$input.unbind("focus.ax5formatter").bind("focus.ax5formatter",r.focus.bind(this,this.queue[i],i)),t.$input.unbind("keydown.ax5formatter").bind("keydown.ax5formatter",r.keydown.bind(this,this.queue[i],i)),t.$input.unbind("keyup.ax5formatter").bind("keyup.ax5formatter",r.keyup.bind(this,this.queue[i],i)),t.$input.unbind("blur.ax5formatter").bind("blur.ax5formatter",r.blur.bind(this,this.queue[i],i)),r.blur.call(this,this.queue[i],i),this},o=function(n){return t.isString(n)||(n=jQuery(n).data("data-formatter")),t.search(this.queue,function(){return this.id==n})};this.init=function(){};this.bind=function(n){var r={},i;if(jQuery.extend(!0,r,u),n&&jQuery.extend(!0,r,n),n=r,!n.target)return console.log(ax5.info.getError("ax5formatter","401","bind")),this;if(n.$target=jQuery(n.target),n.$target.get(0).tagName=="INPUT")n.$input=n.$target;else if(n.$input=n.$target.find('input[type="text"]'),n.$input.length>1)return n.$input.each(function(){n.target=this;e.bind(n)}),this;return n.$input=n.$target.get(0).tagName=="INPUT"?n.$target:n.$target.find('input[type="text"]'),n.id||(n.id=n.$input.data("ax5-formatter")),n.id||(n.id="ax5-formatter-"+ax5.getGuid(),n.$input.data("ax5-formatter",n.id)),i=t.search(this.queue,function(){return this.id==n.id}),i===-1?(this.queue.push(n),f.call(this,this.queue[this.queue.length-1],this.queue.length-1)):(this.queue[i]=n,f.call(this,this.queue[i],i)),this};this.formatting=function(n){var u=t.isNumber(n)?n:o.call(this,n),i;if(u===-1)for(i=this.queue.length;i--;)r.blur.call(this,this.queue[i],i,null,!0);else r.blur.call(this,this.queue[u],u,null,!0);return this};this.unbind=function(){};this.main=function(){arguments&&t.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)}}());n=ax5.ui.formatter})();ax5.ui.formatter_instance=new ax5.ui.formatter;jQuery.fn.ax5formatter=function(){return function(n){if(ax5.util.isString(arguments[0])){var t=arguments[0];switch(t){case"formatting":return ax5.ui.formatter_instance.formatting(this);case"unbind":return ax5.ui.formatter_instance.unbind(this);default:return this}}else typeof n=="undefined"&&(n={}),jQuery.each(this,function(){var t={target:this};n=jQuery.extend({},n,t);ax5.ui.formatter_instance.bind(n)});return this}}(),function(){var n=ax5.ui.formatter,t=ax5.util,i={getEnterableKeyCodes:function(t){var i={"188":","};return t.patternArgument=="int"||(i["190"]="."),jQuery.extend(i,n.formatter.ctrlKeys,n.formatter.numKeys)},getPatternValue:function(n,i,r,u){u=u.replace(/[^0-9^\.^\-]/g,"");var e=new RegExp("([0-9])([0-9][0-9][0-9][,.])"),f=u.split(".");f[0]+=".";do f[0]=f[0].replace(e,"$1,$2");while(e.test(f[0]));return f.length>1?t.isNumber(n.maxRound)?f[0]+t.left(f[1],n.maxRound):f.join(""):f[0].split(".")[0]}},r={getEnterableKeyCodes:function(){return jQuery.extend({"190":"."},n.formatter.ctrlKeys,n.formatter.numKeys)},getPatternValue:function(n,i,r,u){u=u.replace(/[^0-9^\.^\-]/g,"");var f=u.split(".");return f.length>1?t.isNumber(n.maxRound)?f[0]+t.left(f[1],n.maxRound):f.join(""):f[0].split(".")[0]}},u={getEnterableKeyCodes:function(){return jQuery.extend({"189":"-","191":"/"},n.formatter.ctrlKeys,n.formatter.numKeys)},getPatternValue:function(n,i,r,u,f){var s;if(u=u.replace(/\D/g,""),u=="")return u;s=/^([0-9]{4})\-?([0-9]{1,2})?\-?([0-9]{1,2})?.*$/;n.patternArgument=="time"&&(s=/^([0-9]{4})\-?([0-9]{1,2})?\-?([0-9]{1,2})? ?([0-9]{1,2})?:?([0-9]{1,2})?:?([0-9]{1,2})?.*$/);var h=u.match(s),o="",e=function(n,i,r,u){var f={Y:function(n){return typeof n=="undefined"&&(n=TODAY.getFullYear()),(n==""||n=="0000")&&(n=TODAY.getFullYear()),n.length<4?t.setDigit(n,4):n},M:function(n){return typeof n=="undefined"&&(n=TODAY.getMonth()+1),n>12?12:n==0?"01":t.setDigit(n,2)},D:function(n){typeof n=="undefined"&&(n=TODAY.getDate()+1);var i=t.daysOfMonth(u[1],u[2]-1);return n>i?i:n==0?"01":t.setDigit(n,2)},h:function(n){return n||(n=0),n>23?23:t.setDigit(n,2)},m:function(n){return n||(n=0),n>59?59:t.setDigit(n,2)},s:function(n){return n||(n=0),n>59?59:t.setDigit(n,2)}};return r?f[i](n):n};return o=u.replace(s,function(){var t=[e(arguments[1],"Y",f)];return(arguments[2]||f)&&t.push("-"+e(arguments[2],"M",f)),(arguments[3]||f)&&t.push("-"+e(arguments[3],"D",f,arguments)),n.patternArgument=="time"&&((arguments[4]||f)&&t.push(" "+e(arguments[4],"h",f)),(arguments[5]||f)&&t.push(":"+e(arguments[5],"m",f)),(arguments[6]||f)&&t.push(":"+e(arguments[6],"s",f))),t.join("")}),f!="blur"||h?h||(o=o.length>4?t.left(o,4):o):o=function(){var t=[e(o,"Y",f)];return t.push("-"+e(0,"M",f)),t.push("-"+e(0,"D",f,arguments)),n.patternArgument=="time"&&(t.push(" "+e(0,"h",f)),t.push(":"+e(0,"m",f)),t.push(":"+e(0,"s",f))),t.join("")}(),o}},f={getEnterableKeyCodes:function(){return jQuery.extend({"186":":"},n.formatter.ctrlKeys,n.formatter.numKeys)},getPatternValue:function(n,i,r,u){u=u.replace(/\D/g,"");var e=/^([0-9]{1,2})?:?([0-9]{1,2})?:?([0-9]{1,2})?.*$/,o=u.match(e),f=u.replace(e,function(){var n=[arguments[1]];return arguments[2]&&n.push(":"+arguments[2]),arguments[3]&&n.push(":"+arguments[3]),n.join("")});return o||(f=f.length>2?t.left(f,2):f),f}},e={getEnterableKeyCodes:function(){return jQuery.extend({"189":"-"},n.formatter.ctrlKeys,n.formatter.numKeys)},getPatternValue:function(n,t,i,r){r=r.replace(/\D/g,"");return r.replace(/^([0-9]{3})\-?([0-9]{1,2})?\-?([0-9]{1,5})?.*$/,function(){var n=[arguments[1]];return arguments[2]&&n.push(arguments[2]),arguments[3]&&n.push(arguments[3]),n.join("-")})}},o={getEnterableKeyCodes:function(){return jQuery.extend({"189":"-","188":","},n.formatter.ctrlKeys,n.formatter.numKeys)},getPatternValue:function(n,t,i,r){var u;return r=r.replace(/\D/g,""),u=/^([0-9]{3})\-?([0-9]{1,4})?\-?([0-9]{1,4})?\-?([0-9]{1,4})?\-?([0-9]{1,4})?/,r.substr(0,2)=="02"&&(u=/^([0-9]{2})\-?([0-9]{1,4})?\-?([0-9]{1,4})?\-?([0-9]{1,4})?\-?([0-9]{1,4})?/),r.replace(u,function(){var n=[arguments[1]];return arguments[2]&&n.push(arguments[2]),arguments[3]&&n.push(arguments[3]),arguments[4]&&n.push(arguments[4]),arguments[5]&&n.push(arguments[5]),n.join("-")})}},s={getEnterableKeyCodes:function(){return jQuery.extend({"189":"-"},n.formatter.ctrlKeys,n.formatter.numKeys)},getPatternValue:function(n,t,i,r){r=r.replace(/\D/g,"").substring(0,16);return r.replace(/^([0-9]{4})\-?([0-9]{4})?\-?([0-9]{4})?\-?([0-9]{4})?/,function(){var n=[arguments[1]];return arguments[2]&&n.push(arguments[2]),arguments[3]&&n.push(arguments[3]),arguments[4]&&n.push(arguments[4]),n.join("-")})}},h={getEnterableKeyCodes:function(n){return n.getEnterableKeyCodes?n.getEnterableKeyCodes.call(n,{$input:n.$input}):null},getPatternValue:function(n,t,i,r){if(n.getPatternValue)return n.getPatternValue.call(n,{event:i,$input:n.$input,value:r})}};n.formatter={ctrlKeys:{"18":"KEY_ALT","8":"KEY_BACKSPACE","17":"KEY_CONTROL","46":"KEY_DELETE","40":"KEY_DOWN","35":"KEY_END","187":"KEY_EQUAL","27":"KEY_ESC","36":"KEY_HOME","45":"KEY_INSERT","37":"KEY_LEFT","189":"KEY_MINUS","34":"KEY_PAGEDOWN","33":"KEY_PAGEUP","13":"KEY_RETURN","39":"KEY_RIGHT","16":"KEY_SHIFT","9":"KEY_TAB","38":"KEY_UP","91":"KEY_WINDOW"},numKeys:{"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"96":1,"97":1,"98":1,"99":1,"100":1,"101":1,"102":1,"103":1,"104":1,"105":1},money:i,number:r,date:u,time:f,bizno:e,phone:o,credit:s,custom:h}}();